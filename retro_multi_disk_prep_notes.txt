Make a partion on the MicroSD card with parted (use the dd comand to wipe the MicroSD card first - below):

Use lsblk to find your MicroSD Card name. Mine is mmcblk0 because I use a MicroSD card adapter in an SD card slot on my laptop.
It could also be sdb, sdc etc if you use a USB adapter. BE CERTAIN YOU HAVE THE CORRECT DEVICE TO AVOID DESTROYING DATA!

sudo parted /dev/mmcblk0
GNU Parted 3.4
Using /dev/mmcblk0
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) mklabel msdos 
(parted) mkpart primary 1MiB 129MiB  
(parted) print							
Model: SD NCard (sd/mmc)
Disk /dev/mmcblk0: 15.6GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags: 

Number  Start   End    Size   Type     File system  Flags
 1      1049kB  135MB  134MB  primary               lba

(parted) q 


Various dd commands for adding disks:

Clear the MicroSD card before making a patition:
sudo dd if=/dev/zero of=/dev/mmcblk0 bs=512 conv=sync count=264192 status=progress

Write a disk image to a slot on the disk patition. Slots are numbered 0-15. Each slot is
16384 blocks in size (0x4000). seek=01x16384 - 16384 in decimal is the start of the 
second disk slot. You don't need the seek statement for disk 0, but it's included for consistency.
Currently only disk slots 0-3 are supported by the Z80 Retro. It can support up to 16 8MB disks,
but this would reqiuire 8K of RAM (512 byte ALV buffer per drive), which in my opinion is a 
waste of RAM unless really needed. We'll be looking at this more.

disk 0: sudo dd if=0.img of=/dev/mmcblk0p1 bs=512 seek=00x16384 conv=sync status=progress
disk 1: sudo dd if=1.img of=/dev/mmcblk0p1 bs=512 seek=01x16384 conv=sync status=progress
disk 2: sudo dd if=2.img of=/dev/mmcblk0p1 bs=512 seek=02x16384 conv=sync status=progress
disk 3: sudo dd if=3.img of=/dev/mmcblk0p1 bs=512 seek=03x16384 conv=sync status=progress
etc.

The disks do not need to be written to the MicroSD card in any specific order. You can write
to any of the slots whenever you want to change the drive. I name the image file with the
number of the disk slot just to keep it straight which image goes in which slot. The only critical
disk is the first, slot 0. Slot 0 must contain the BIOS - retro.bin or your system won't boot. You can
name the image anything you'd like - whatever makes sense to you - example wordstar4.img for an image 
containing Wordstar 4.

Let me know if you find bugs!

Trevor Jacobs - 02/16/2023


                                                                                                           
